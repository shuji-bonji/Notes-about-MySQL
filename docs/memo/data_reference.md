#  データの参照 

## SELECT

### 構文


```sql
SELECT フィールド名 FORM テーブル名 [WHERE 条件];

```


### 実例


#### 全てのフィールドのデータを参照

```mysql
mysql> SELECT * FROM M_USERS;
+----+-----------------+-----------------+-----+------+
| no | lname           | fname           | age | sex  |
+----+-----------------+-----------------+-----+------+
|  1 | オダ            | ノブナガ        |  20 | M    |
|  2 | オダ            | ノブユキ          |  19 | M    |
|  3 | シュウカマ      | マサコ          |  40 | F    |
|  4 | キバヤシ        | リョウスケ      |  34 | X    |
|  5 | カナメ          | リン            |  26 | F    |
+----+-----------------+-----------------+-----+------+
5 rows in set (0.00 sec)

```

#### フィールドを指定して参照

```mysql
mysql> SELECT lname, fname FROM M_USERS;
+-----------------+-----------------+
| lname           | fname           |
+-----------------+-----------------+
| オダ          | ノブナガ        |
| オダ          | ノブユキ          |
| シュウカマ      | マサコ          |
| キバヤシ        | リョウスケ      |
| カナメ          | リン            |
+-----------------+-----------------+
5 rows in set (0.00 sec)

```

#### 条件を指定して参照

```mysql
mysql> SELECT lname, fname FROM M_USERS WHERE sex='M' AND age>= 20;
+-----------+--------------+
| lname     | fname        |
+-----------+--------------+
| オダ    | ノブナガ     |
+-----------+--------------+
1 row in set (0.00 sec)

```

#### AS


```mysql
mysql> SELECT lname as LASTNAME, fname as FirstName from M_USERS;
+-----------------+-----------------+
| LASTNAME        | FirstName       |
+-----------------+-----------------+
| オダ          | ノブナガ        |
| オダ          | ノブユキ          |
| シュウカマ      | マサコ          |
| キバヤシ        | リョウスケ      |
| カナメ          | リン            |
+-----------------+-----------------+
5 rows in set (0.00 sec)

```

## ORDER BY

`SELECT`文の結果をソートする

### 構文


```sql
SELECT文 ORDER BY フィールド名1 [ASC|DESC][, フィールド2 [ASC|DESC], ...]);

```


### 実例

```mysql
mysql> SELECT * FROM M_USERS ORDER BY age DESC;
+----+-----------------+-----------------+-----+------+
| no | lname           | fname           | age | sex  |
+----+-----------------+-----------------+-----+------+
|  3 | シュウカマ      | マサコ          |  40 | F    |
|  4 | キバヤシ        | リョウスケ      |  34 | X    |
|  5 | カナメ          | リン            |  26 | F    |
|  1 | オダ            | ノブナガ        |  20 | M    |
|  2 | オダ            | ノブユキ          |  19 | M    |
+----+-----------------+-----------------+-----+------+
5 rows in set (0.00 sec)


```

## DISTINCT

`SELECT`文の結果から重複を除去するには`DISTINCT`を使います。

### 構文


```sql
SELECT DISTINCT フィールド名 FROM テーブル名;

```


### 実例

```mysql
mysql> SELECT DISTINCT lname FROM M_USERS;
+-----------------+
| lname           |
+-----------------+
| オダ          |
| シュウカマ      |
| キバヤシ        |
| カナメ          |
+-----------------+
4 rows in set (0.00 sec)



```

## UNION

SELECT文の結果を結合するには`UNION`または、`UNION ALL`を使います。

### 構文


```sql
SELECT フィールド名 FORM テーブル名 UNION [ALL] SELECT フィールド名 FROM テーブル名;

```


### 実例

```mysql
mysql> SELECT * from M_MANAGERS;
+----+-----------+--------------+
| no | lname     | fname        |
+----+-----------+--------------+
|  1 | オダ    | ノブナガ     |
|  2 | ムウラ    | カズヨシ     |
+----+-----------+--------------+
2 rows in set (0.00 sec)

mysql> SELECT * FROM M_USERS;
+----+-----------------+-----------------+-----+------+
| no | lname           | fname           | age | sex  |
+----+-----------------+-----------------+-----+------+
|  1 | オダ            | ノブナガ        |  20 | M    |
|  2 | オダ            | ノブユキ          |  19 | M    |
|  3 | シュウカマ      | マサコ          |  40 | F    |
|  4 | キバヤシ        | リョウスケ      |  34 | X    |
|  5 | カナメ          | リン            |  26 | F    |
+----+-----------------+-----------------+-----+------+
5 rows in set (0.00 sec)

mysql> SELECT lname, fname FROM M_USERS WHERE age >= 20 UNION SELECT lname, fname FROM M_MANAGERS;
+-----------------+-----------------+
| lname           | fname           |
+-----------------+-----------------+
| オダ          | ノブナガ        |
| シュウカマ      | マサコ          |
| キバヤシ        | リョウスケ      |
| カナメ          | リン            |
| ムウラ          | カズヨシ        |
+-----------------+-----------------+
5 rows in set (0.00 sec)

mysql> SELECT lname, fname FROM M_USERS WHERE age <= 20 UNION SELECT lname, fname FROM M_MANAGERS;
+-----------+--------------+
| lname     | fname        |
+-----------+--------------+
| オダ    | ノブナガ     |
| オダ    | ノブユキ       |
| ムウラ    | カズヨシ     |
+-----------+--------------+
3 rows in set (0.00 sec)

mysql> SELECT lname, fname FROM M_USERS WHERE age <= 20 UNION ALL SELECT lname, fname FROM M_MANAGERS;
+-----------+--------------+
| lname     | fname        |
+-----------+--------------+
| オダ    | ノブナガ     |
| オダ    | ノブユキ       |
| オダ    | ノブナガ     |
| ムウラ    | カズヨシ     |
+-----------+--------------+
4 rows in set (0.00 sec)
```

## BETWEEN

SELECT文の条件範囲を絞り込むような指定は`BETWEEN`で行います。

### 構文

「〜以上、かつ〜以下」のような範囲を絞り込む場合は不等号`<``>`を使うより、BETWEENを使う方がスマートです。

```sql
SELECT文 WHERE フィールド名 BETWEEN 値 AND 値;

```


### 実例

```mysql
mysql> SELECT * FROM M_USERS;
+----+-----------------+-----------------+-----+------+
| no | lname           | fname           | age | sex  |
+----+-----------------+-----------------+-----+------+
|  1 | オダ            | ノブナガ        |  20 | M    |
|  2 | オダ            | ノブユキ          |  19 | M    |
|  3 | シュウカマ      | マサコ          |  40 | F    |
|  4 | キバヤシ        | リョウスケ      |  34 | X    |
|  5 | カナメ          | リン            |  26 | F    |
+----+-----------------+-----------------+-----+------+
5 rows in set (0.00 sec)

mysql> SELECT lname, fname FROM M_USERS WHERE age BETWEEN 20 AND 35;
+--------------+-----------------+
| lname        | fname           |
+--------------+-----------------+
| オダ       | ノブナガ        |
| キバヤシ     | リョウスケ      |
| カナメ       | リン            |
+--------------+-----------------+
3 rows in set (0.00 sec)
```

## IN

特定のフィールドに対して「いずれかの値が含まれる場合」といった条件の指定は`IN`を使います。


### 構文


```sql
SELECT文 WHERE フィールド名 IN (値, 値, 値, ...);

```
!!! note
    多くのRDBMSは`IN`に指定できる値数の上限は1000程です。

### 実例

```mysql

mysql> SELECT * FROM M_USERS;
+----+-----------------+-----------------+-----+------+
| no | lname           | fname           | age | sex  |
+----+-----------------+-----------------+-----+------+
|  1 | オダ            | ノブナガ        |  20 | M    |
|  2 | オダ            | ノブユキ          |  19 | M    |
|  3 | シュウカマ      | マサコ          |  40 | F    |
|  4 | キバヤシ        | リョウスケ      |  34 | X    |
|  5 | カナメ          | リン            |  26 | F    |
+----+-----------------+-----------------+-----+------+
5 rows in set (0.00 sec)

mysql> SELECT lname,fname FROM M_USERS WHERE sex IN('M', 'X');
+--------------+-----------------+
| lname        | fname           |
+--------------+-----------------+
| オダ       | ノブナガ        |
| オダ       | ノブユキ          |
| キバヤシ     | リョウスケ      |
+--------------+-----------------+
3 rows in set (0.00 sec)

```

## GROUP BY

`GROUP BY`は集計を行うための命令です。  
レコードの件数を取得する`COUNT`や、フィールドの合計を算出する`SUM`などの集計関数と一緒に利用するケースが多い。

### 構文


```sql
SELECT文 GROUP BY フィールド名;

```

### 実例

```mysql
mysql> SELECT * FROM M_USERS;
+----+-----------------+-----------------+-----+------+
| no | lname           | fname           | age | sex  |
+----+-----------------+-----------------+-----+------+
|  1 | オダ            | ノブナガ        |  20 | M    |
|  2 | オダ            | ノブユキ          |  19 | M    |
|  3 | シュウカマ      | マサコ          |  40 | F    |
|  4 | キバヤシ        | リョウスケ      |  34 | X    |
|  5 | カナメ          | リン            |  26 | F    |
+----+-----------------+-----------------+-----+------+
5 rows in set (0.00 sec)

mysql> SELECT COUNT(sex) AS CNT, sex FROM M_USERS GROUP BY sex;
+-----+------+
| CNT | sex  |
+-----+------+
|   2 | M    |
|   2 | F    |
|   1 | X    |
+-----+------+
3 rows in set (0.00 sec)

```

## HAVING

`HAVING`は集計した結果を絞り込むための命令です。

### 構文


```sql
SELECT文 GROUP BY文 HAVING 条件;

```


### 実例

```mysql
mysql> SELECT COUNT(sex) AS CNT, sex FROM M_USERS GROUP BY sex HAVING CNT > 1;
+-----+------+
| CNT | sex  |
+-----+------+
|   2 | M    |
|   2 | F    |
+-----+------+
2 rows in set (0.00 sec)

mysql> SELECT * FROM M_USERS;
+----+-----------------+-----------------+-----+------+
| no | lname           | fname           | age | sex  |
+----+-----------------+-----------------+-----+------+
|  1 | オダ            | ノブナガ        |  20 | M    |
|  2 | オダ            | ノブユキ          |  19 | M    |
|  3 | シュウカマ      | マサコ          |  40 | F    |
|  4 | キバヤシ        | リョウスケ      |  34 | X    |
|  5 | カナメ          | リン            |  26 | F    |
+----+-----------------+-----------------+-----+------+
5 rows in set (0.00 sec)

mysql> SELECT COUNT(sex) AS CNT, sex FROM M_USERS GROUP BY sex HAVING CNT > 1;
+-----+------+
| CNT | sex  |
+-----+------+
|   2 | M    |
|   2 | F    |
+-----+------+
2 rows in set (0.00 sec)


```

## CASE

条件分岐が必要なときに、`CASE`を使います。


### 構文


```sql
SELECT フィールド名
  CASE
    WHEN 値 THEN 返却値 
    WHEN 値 THEN 返却値 
    ELSE 返却値
  END; 
FROM テーブル名;

```


### 実例

```mysql
mysql> SELECT * FROM M_USERS;
+----+-----------------+-----------------+-----+------+
| no | lname           | fname           | age | sex  |
+----+-----------------+-----------------+-----+------+
|  1 | オダ            | ノブナガ        |  20 | M    |
|  2 | オダ            | ノブユキ          |  19 | M    |
|  3 | シュウカマ      | マサコ          |  40 | F    |
|  4 | キバヤシ        | リョウスケ      |  34 | X    |
|  5 | カナメ          | リン            |  26 | F    |
+----+-----------------+-----------------+-----+------+
5 rows in set (0.00 sec)

mysql> SELECT lname, fname,
    ->   CASE
    ->     WHEN sex='M' THEN '男性'
    ->     WHEN sex='F' THEN '女性'
    ->     ELSE 'その他'
    ->   END AS SEI
    -> FROM M_USERS;
+-----------------+-----------------+-----------+
| lname           | fname           | SEI       |
+-----------------+-----------------+-----------+
| オダ          | ノブナガ        | 男性      |
| オダ          | ノブユキ          | 男性      |
| シュウカマ      | マサコ          | 女性      |
| キバヤシ        | リョウスケ      | その他    |
| カナメ          | リン            | 女性      |
+-----------------+-----------------+-----------+
5 rows in set (0.00 sec)


```

## JOIN
テーブルの結合には`JOIN`を使います。

結合にはいくつか種類がありますが、「内部結合」と「外部結合」を押さえておけば大抵は問題ありません。

## JOIN(内部結合)
内部結合は結合対象の両者に存在するデータのみを抽出する

### 構文


```sql
SELECT フィールド名 FROM ターブル名1 INNER JOIN テーブル名2 ON 結合の条件;
```


### 実例

```mysql
mysql> SELECT * FROM M_USERS;
+----+-----------------+-----------------+-----+------+
| no | lname           | fname           | age | sex  |
+----+-----------------+-----------------+-----+------+
|  1 | オダ            | ノブナガ        |  20 | M    |
|  2 | オダ            | ノブユキ          |  19 | M    |
|  3 | シュウカマ      | マサコ          |  40 | F    |
|  4 | キバヤシ        | リョウスケ      |  34 | X    |
|  5 | カナメ          | リン            |  26 | F    |
+----+-----------------+-----------------+-----+------+
5 rows in set (0.00 sec)

mysql> SELECT * FROM M_SEX;
+------+--------+
| sex  | SEI    |
+------+--------+
| M    | 男性   |
| F    | 女性   |
+------+--------+
2 rows in set (0.00 sec)

mysql> SELECT u.lname, u.fname, s.SEI FROM M_USERS u INNER JOIN M_SEX s ON u.sex = s.sex;
+-----------------+--------------+--------+
| lname           | fname        | SEI    |
+-----------------+--------------+--------+
| オダ          | ノブナガ     | 男性   |
| オダ          | ノブユキ       | 男性   |
| シュウカマ      | マサコ       | 女性   |
| カナメ          | リン         | 女性   |
+-----------------+--------------+--------+

```


## JOIN(外部結合)

外部結合は結合する一方にデータが存在すれば抽出されます

### 構文


```sql
SELECT フィールド名 FROM ターブル名1 LEFT OUTER JOIN テーブル名2 ON 結合の条件;

```


### 実例

```mysql
mysql> SELECT * FROM M_USERS;
+----+-----------------+-----------------+-----+------+
| no | lname           | fname           | age | sex  |
+----+-----------------+-----------------+-----+------+
|  1 | オダ            | ノブナガ        |  20 | M    |
|  2 | オダ            | ノブユキ          |  19 | M    |
|  3 | シュウカマ      | マサコ          |  40 | F    |
|  4 | キバヤシ        | リョウスケ      |  34 | X    |
|  5 | カナメ          | リン            |  26 | F    |
+----+-----------------+-----------------+-----+------+
5 rows in set (0.00 sec)

mysql> SELECT * FROM M_SEX;
+------+--------+
| sex  | SEI    |
+------+--------+
| M    | 男性   |
| F    | 女性   |
+------+--------+
2 rows in set (0.00 sec)

mysql> SELECT u.lname, u.fname, s.SEI FROM M_USERS u LEFT OUTER JOIN M_SEX s ON u.sex = s.sex;
+-----------------+-----------------+--------+
| lname           | fname           | SEI    |
+-----------------+-----------------+--------+
| オダ          | ノブナガ        | 男性   |
| オダ          | ノブユキ          | 男性   |
| シュウカマ      | マサコ          | 女性   |
| キバヤシ        | リョウスケ      | NULL   |
| カナメ          | リン            | 女性   |
+-----------------+-----------------+--------+
5 rows in set (0.00 sec)

```
